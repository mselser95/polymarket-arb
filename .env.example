# ========================================
# Polymarket API Credentials
# ========================================

# Builder API credentials (from Polymarket UI or derive-api-creds command)
POLYMARKET_API_KEY=
POLYMARKET_SECRET=
POLYMARKET_PASSPHRASE=

# Your Ethereum private key (without 0x prefix)
# SECURITY WARNING: Never commit this to git!
POLYMARKET_PRIVATE_KEY=

# Your EOA address (auto-derived from private key if not provided)
POLYMARKET_ADDRESS=

# Optional: Proxy wallet address (if using Gnosis Safe)
POLYMARKET_PROXY_ADDRESS=

# Signature type: 0=EOA (default), 1=POLY_PROXY, 2=POLY_GNOSIS_SAFE
POLYMARKET_SIGNATURE_TYPE=0

# ========================================
# Polymarket API Endpoints
# ========================================

# WebSocket feed for orderbook updates
POLYMARKET_WS_URL=wss://ws-subscriptions-clob.polymarket.com/ws/market

# Gamma API for market discovery
POLYMARKET_GAMMA_API_URL=https://gamma-api.polymarket.com

# ========================================
# Arbitrage Detection
# ========================================

# Maximum acceptable price sum (YES + NO must be below this value to trigger arbitrage)
# Lower value = STRICTER (requires bigger spread, fewer opportunities)
# Higher value = LOOSER (accepts smaller spread, more opportunities)
# Examples: 0.98 = 2% spread (strict), 0.995 = 0.5% spread (moderate), 0.998 = 0.2% spread (loose)
ARB_MAX_PRICE_SUM=0.998

# Minimum trade size in USD (must be >= per-market minimums, typically ~$2.50)
ARB_MIN_TRADE_SIZE=1.0

# Maximum trade size in USD (caps calculated size from orderbook liquidity)
ARB_MAX_TRADE_SIZE=2.0

# Polymarket fee structure (Polymarket charges 0% fees on all trades)
ARB_MAKER_FEE=0.0000  # 0% maker fee
ARB_TAKER_FEE=0.0000  # 0% taker fee

# How often to check for arbitrage opportunities
ARB_DETECTION_INTERVAL=100ms

# Only track markets expiring within this duration (0 = unlimited, no filtering)
# Examples: 1h, 6h, 24h, 720h (30 days), 0 (all markets)
ARB_MAX_MARKET_DURATION=0

# ========================================
# Execution Mode
# ========================================

# Execution mode:
#   - "dry-run": Detect opportunities only, no execution (safest)
#   - "paper":   Simulate trades, track hypothetical profit
#   - "live":    Execute real trades (requires approval + balance)
EXECUTION_MODE=dry-run

# Maximum position size (risk management)
EXECUTION_MAX_POSITION_SIZE=1000.0

# ========================================
# Circuit Breaker (Balance Protection)
# ========================================

# Enable/disable circuit breaker
CIRCUIT_BREAKER_ENABLED=true

# How often to check wallet balance (300s = 5 minutes)
CIRCUIT_BREAKER_CHECK_INTERVAL=300s

# Disable threshold = avg_trade_size × this multiplier
# Example: avg trade = $10, multiplier = 3.0 → disable at $30
CIRCUIT_BREAKER_TRADE_MULTIPLIER=3.0

# Absolute minimum USDC balance (floor when no trade history)
CIRCUIT_BREAKER_MIN_ABSOLUTE=5.0

# Re-enable threshold = disable_threshold × this ratio
# Example: disable at $30, ratio = 1.5 → re-enable at $45
# Prevents rapid on/off cycling ("flapping")
CIRCUIT_BREAKER_HYSTERESIS_RATIO=1.5

# ========================================
# Market Discovery
# ========================================

# How often to poll for new markets
DISCOVERY_POLL_INTERVAL=30s

# Market discovery limit (0 = unlimited, fetch all available markets)
# Warning: Setting to 0 may fetch thousands of markets
# Actual subscriptions filtered by ARB_MAX_MARKET_DURATION (default: unlimited)
# Markets are automatically sorted by 24h volume (DESC) to prioritize most liquid markets
# 2500 markets × 2 tokens = ~5000 WebSocket subscriptions (for binary markets)
DISCOVERY_MARKET_LIMIT=2500

# How often cleanup checks for stale/expired markets
CLEANUP_CHECK_INTERVAL=5m

# ========================================
# WebSocket Configuration
# ========================================

# WebSocket connection pool size (default: 5)
# More connections = higher throughput, more redundancy
# Recommended: 5-10 for production
WS_POOL_SIZE=5

# Connection timeouts
WS_DIAL_TIMEOUT=10s
WS_PONG_TIMEOUT=15s
WS_PING_INTERVAL=10s

# Reconnection backoff
WS_RECONNECT_INITIAL_DELAY=1s
WS_RECONNECT_MAX_DELAY=30s
WS_RECONNECT_BACKOFF_MULTIPLIER=2.0

# Message buffer size (drop messages if consumer slow)
# CRITICAL: Set high enough to handle burst traffic (7K+ ops/sec)
# Monitor "Messages Dropped/sec" in Grafana to tune
WS_MESSAGE_BUFFER_SIZE=100000

# ========================================
# Blockchain / RPC
# ========================================

# Polygon RPC endpoint for balance checks and on-chain transactions
# Free public endpoint (may be slow/rate-limited):
POLYGON_RPC_URL=https://polygon-rpc.com

# Alternative paid endpoints (faster, more reliable):
# POLYGON_RPC_URL=https://polygon-mainnet.g.alchemy.com/v2/YOUR_KEY
# POLYGON_RPC_URL=https://rpc-mainnet.maticvigil.com
# POLYGON_RPC_URL=https://polygon-mainnet.infura.io/v3/YOUR_KEY

# ========================================
# Storage
# ========================================

# Storage mode: "console" (stdout) or "postgres" (database)
STORAGE_MODE=console

# PostgreSQL configuration (only used if STORAGE_MODE=postgres)
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_USER=polymarket
POSTGRES_PASSWORD=polymarket123
POSTGRES_DB=polymarket_arb
POSTGRES_SSLMODE=disable

# ========================================
# Logging & Observability
# ========================================

# Log level: debug, info, warn, error
LOG_LEVEL=info

# HTTP server port for metrics and health checks
# Metrics: http://localhost:8080/metrics
# Health:  http://localhost:8080/health
HTTP_PORT=8080

# ========================================
# Quick Start Guide
# ========================================

# 1. Copy this file to .env:
#    cp .env.example .env
#
# 2. Get your credentials:
#    - Go to https://polymarket.com/settings/api
#    - OR run: go run . derive-api-creds
#
# 3. Fill in the credentials above
#
# 4. Start in dry-run mode (safest):
#    EXECUTION_MODE=dry-run go run . run
#
# 5. Switch to paper trading to test:
#    EXECUTION_MODE=paper go run . run
#
# 6. Before going live:
#    - Check balance: go run . balance
#    - Approve USDC: go run . approve
#    - Start small: ARB_MAX_TRADE_SIZE=5.0
#    - EXECUTION_MODE=live go run . run

# ========================================
# Configuration Profiles
# ========================================

# Loose Detection (more opportunities, smaller spreads):
#   ARB_MAX_PRICE_SUM=0.998
#   ARB_MIN_TRADE_SIZE=1.0
#   ARB_MAX_TRADE_SIZE=5.0
#
# Strict Detection (fewer opportunities, larger spreads):
#   ARB_MAX_PRICE_SUM=0.98
#   ARB_MIN_TRADE_SIZE=10.0
#   ARB_MAX_TRADE_SIZE=50.0
#
# Conservative Circuit Breaker (keep large buffer):
#   CIRCUIT_BREAKER_TRADE_MULTIPLIER=5.0
#   CIRCUIT_BREAKER_MIN_ABSOLUTE=10.0
#   CIRCUIT_BREAKER_HYSTERESIS_RATIO=2.0
#
# Aggressive Circuit Breaker (use more funds):
#   CIRCUIT_BREAKER_TRADE_MULTIPLIER=2.0
#   CIRCUIT_BREAKER_MIN_ABSOLUTE=3.0
#   CIRCUIT_BREAKER_HYSTERESIS_RATIO=1.3
